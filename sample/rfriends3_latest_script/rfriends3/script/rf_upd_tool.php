<?php
 function rf_update_fin_tool() { global $tmpdir; $upbtxt_fl = "update_bin.txt"; $upbin_fl = "update_bin.zip"; $tmpdir_rf = $tmpdir."rfriends3"; fin_unlink($tmpdir.$upbtxt_fl); fin_unlink($tmpdir.$upbin_fl); rm_dir($tmpdir_rf); return; } function rf_update_get_tool($fl, $dir, $ty) { global $rfriends; $url = rf_get_down_url(0,$ty); if ($url === false) { return false; } $src = $url."update/".$fl; $dst = $dir.$fl; $ret = rf_wget($src, $dst, ""); return ($ret); } function rf_update_bin_win($rpath, $ty) { global $tmpdir; global $base; global $rfriends; global $DS; $upbtxt_fl = "update_bin.txt"; $upbin_fl = "update_bin.zip"; $tmpdir_rf = $tmpdir."rfriends3"; fin_unlink($tmpdir.$upbtxt_fl); fin_unlink($tmpdir.$upbin_fl); echo_msg(2, "ダウンロード(bin)....."); $ret = rf_update_get_tool($upbin_fl, $tmpdir, $ty); if ($ret === false) { echo_msg(2, "$upbin_fl ファイルがありません。"); return(1); } echo_msg(2, "検証(bin)....."); rm_dir($tmpdir."rfriends3"); $ret = rf_update_unzip($tmpdir.$upbin_fl, $tmpdir, "", 0); fin_unlink($tmpdir.$upbin_fl); if ($ret !== true) { echo_msg(2, "$upbin_fl ファイルが異常です。"); return(1); } echo_msg(2, "アップデート(bin)....."); echo_msg(2, "copy $tmpdir -> $rpath"); $ret = rf_update_copy("rfriends3", $tmpdir, $rpath); if ($ret == 0) { echo_msg(2, "アップデート(bin)完了"); } else { echo_msg(2, "アップデート(bin)異常終了"); $ret = -1; } rm_dir($tmpdir_rf); return($ret); } 